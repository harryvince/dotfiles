#!/bin/bash

# Get a list of all EC2 instances and format the output as "name - instance_id"
instances=$(aws ec2 describe-instances --query "Reservations[].Instances[].[Tags[?Key=='Name'].Value[],InstanceId]" --output text | tr '\t' ' ' | sed 's/\n/ /g' | sed 's/  / - /g')

# Use fzf to allow the user to select an instance from the list
selected_instance=$(echo "$instances" | fzf --header 'Select an EC2 instance to connect to:' | awk '{print $NF}')

# If the user selected an instance, connect to it using SSM
if [ -n "$selected_instance" ]; then
  aws ssm start-session --target "$selected_instance"
fi
